@if (!showPanel) {
  @if (loadingService.isLoading$ | async) {
    <mat-progress-bar mode="indeterminate" color="accent" style="position: fixed; top: 0; left: 0; z-index: 9999; width: 100%;"></mat-progress-bar>
  }
  
  <router-outlet></router-outlet>
} @else {
  <mat-sidenav-container class="app-container">
    @if (loadingService.isLoading$ | async) {
      <mat-progress-bar mode="indeterminate" color="accent" style="position: absolute; top: 0; z-index: 9999;"></mat-progress-bar>
    }
    <mat-sidenav #sidenav mode="side" opened class="app-sidenav">
      
      <div class="sidenav-header" routerLink="/perfil" matRipple>
        <div class="user-avatar">
          {{ loginService.getUsername().charAt(0).toUpperCase() }}
        </div>
        <div class="header-text">
          <span class="user-name">{{ loginService.getUsername() }}</span>
          <span class="role-badge">
            {{ loginService.isAdmin() ? 'Administrador' : 'Paciente' }}
          </span>
        </div>
      </div>

      <div style="flex-grow: 1"></div> <mat-divider style="margin: 10px 0;"></mat-divider>

        <a mat-list-item (click)="loginService.cerrarSesion()" routerLink="/login" style="cursor: pointer;">
          <mat-icon matListItemIcon style="color: #d32f2f;">logout</mat-icon>
          <span matListItemTitle style="color: #d32f2f; font-weight: 500;">Cerrar Sesi칩n</span>
        </a>

      <mat-nav-list>
        @if (loginService.isAdmin()) {
          <div mat-subheader style="color: gray; font-size: 0.8rem; margin-top: 10px;">ADMINISTRACI칍N</div>

          <a mat-list-item routerLink="/usuarios" routerLinkActive="active-link">
            <mat-icon matListItemIcon>group</mat-icon>
            <span matListItemTitle>Gestionar Usuarios</span>
          </a>
          <a mat-list-item routerLink="/roles" routerLinkActive="active-link">
            <mat-icon matListItemIcon>admin_panel_settings</mat-icon>
            <span matListItemTitle>Gestionar Roles</span>
          </a>
          <a mat-list-item routerLink="/planes" routerLinkActive="active-link">
            <mat-icon matListItemIcon>card_membership</mat-icon>
            <span matListItemTitle>Gestionar Planes</span>
          </a>
          <a mat-list-item routerLink="/usuario-suscripcion" routerLinkActive="active-link">
            <mat-icon matListItemIcon>assignment_ind</mat-icon>
            <span matListItemTitle>Asignar Suscripciones</span>
          </a>
          <a mat-list-item routerLink="/ejercicios" routerLinkActive="active-link">
            <mat-icon matListItemIcon>fitness_center</mat-icon>
            <span matListItemTitle>Banco de Ejercicios</span>
          </a>
          <a mat-list-item routerLink="/sintomas" routerLinkActive="active-link">
            <mat-icon matListItemIcon>healing</mat-icon>
            <span matListItemTitle>Cat치logo S칤ntomas</span>
          </a>
          
          <a mat-list-item routerLink="/crisis-sintomas" routerLinkActive="active-link">
            <mat-icon matListItemIcon>fact_check</mat-icon>
            <span matListItemTitle>Relaci칩n Crisis-S칤ntomas</span>
          </a>

          <a mat-list-item routerLink="/emociones" routerLinkActive="active-link">
            <span matListItemIcon style="font-size: 20px;">游떀</span>
            <span matListItemTitle>Cat치logo Emociones</span>
          </a>
          <a mat-list-item routerLink="/alerta" routerLinkActive="active-link">
            <mat-icon matListItemIcon>add_alert</mat-icon>
            <span matListItemTitle>Alertas Globales</span>
          </a>
          <a mat-list-item routerLink="/crisis" routerLinkActive="active-link">
            <mat-icon matListItemIcon>favorite</mat-icon>
            <span matListItemTitle>Historial de Crisis</span>
          </a>
          <a mat-list-item routerLink="/reportes" routerLinkActive="active-link">
            <mat-icon matListItemIcon>bar_chart</mat-icon>
            <span matListItemTitle>Graficos de Reportes</span>
          </a>
          
        }

        @if (loginService.isPaciente() || loginService.isAdmin()) {
          <div mat-subheader style="color: gray; font-size: 0.8rem; margin-top: 10px;">MI PROGRESO</div>
          
          <a mat-list-item routerLink="/diarios" routerLinkActive="active-link">
            <mat-icon matListItemIcon>book</mat-icon>
            <span matListItemTitle>Mi Diario</span>
          </a>
          <a mat-list-item routerLink="/usuarioEjercicios" routerLinkActive="active-link">
            <mat-icon matListItemIcon>accessibility_new</mat-icon>
            <span matListItemTitle>Mis Ejercicios</span>
          </a>
          <a mat-list-item routerLink="/progreso" routerLinkActive="active-link">
            <mat-icon matListItemIcon>insights</mat-icon>
            <span matListItemTitle>Mi Progreso</span>
          </a>
          <a mat-list-item routerLink="/juegos" routerLinkActive="active-link">
            <mat-icon matListItemIcon>sports_esports</mat-icon>
            <span matListItemTitle>Gimnasio Emocional</span>
          </a>
          <a mat-list-item routerLink="/biblioteca" routerLinkActive="active-link">
            <mat-icon matListItemIcon>menu_book</mat-icon>
            <span matListItemTitle>Biblioteca</span>
          </a>
        }

        @if (loginService.isPaciente() || loginService.isAdmin()) {
          <div mat-subheader>HERRAMIENTAS DE CALMA</div>

          <a mat-list-item routerLink="/modo-reflexion" routerLinkActive="active-link">
            <mat-icon matListItemIcon>self_improvement</mat-icon> 
            <span matListItemTitle>Modo Reflexi칩n</span>
          </a>

          <a mat-list-item routerLink="/grabadora" routerLinkActive="active-link">
            <mat-icon matListItemIcon>mic</mat-icon>
            <span matListItemTitle>Bit치cora de Voz</span>
          </a>

          <a mat-list-item routerLink="/musica" routerLinkActive="active-link">
            <mat-icon matListItemIcon>headphones</mat-icon>
            <span matListItemTitle>Musicoterapia</span>
          </a>
        }
      </mat-nav-list>
    </mat-sidenav>

    <mat-sidenav-content class="app-content">
      <mat-toolbar class="content-toolbar" color="primary">
        <button mat-icon-button (click)="sidenav.toggle()">
          <mat-icon>menu</mat-icon>
        </button>
        
        <span>NeuroBridge</span>
        
        <span class="spacer" style="flex: 1 1 auto;"></span>
        
        <button mat-button (click)="loginService.cerrarSesion()" routerLink="/login">
          <mat-icon>logout</mat-icon> Salir
        </button>
      </mat-toolbar>

      <div class="page-content" style="padding: 20px;">
        <router-outlet></router-outlet>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
}
<app-reproductor></app-reproductor>